
<head> 
    <% content_for :stylesheets do %>
        <%= stylesheet_link_tag 'main' %>
    <% end %>
</head>
<body>
    <div id = "box" class="container"> 
        <div class="tab">
            <% if @user_dish_zipcode.count > 0 %>
                <button class="tablinks" data-inline="true" onclick="openPage(event, 'zipcode')">Zipcode</button>
            <% end %>
            <% if @user_dish_cuisine.count > 0 %>
                <button class="tablinks" data-inline="true" onclick="openPage(event, 'fav_cuisine')">Cuisine</button>
            <% end %>
            <button class="tablinks" data-inline="true" onclick="openPage(event, 'all')" id="all_button">ALL</button>
        </div>
        <% if @user_dish_zipcode.count > 0 %>
            <div id="zipcode" class="tabcontent">
                <h1> Today's dishes for based on zipcode</h1>
                <br>
                <% @user_dish_zipcode.each do |dish| %>
                    <div class="dish"> 
                        <div class="dishtitle">
                            <b><%= dish.dishname %></b> (Only <%= dish.quantity %> servings left! )
                        </div>
                        <div class="dishdetails">
                            <div class="row">
                                <div class="col-md-6 col-sm-12">
                                    Cuisine : <%= dish.cuisine %><br>
                                    Price : $<%= dish.price %><br>
                                    Seller : <%= dish.name %><br>
                                    Description : <%= dish.description %><br>
                                    Zipcode : <%= dish.zipcode %>
                                </div>
                                <div class="col-md-6 col-sm-12 buy_button">
                                    <button class="<%= dish.dishname %>" onclick="showBuyBlock('zipcode <%= dish.dishname %>')"> BUY </button>
                                </div>
                            </div>
                            <div class="row buy_block" id="zipcode <%= dish.dishname %>">
                                <div class="col-md-6"> <button class = "buy"> PLACE ORDER </button> </div>
                                <div class="col-md-6"> <button class = "buy" onclick="hideBuyBlock('zipcode <%= dish.dishname %>')"> CANCEL ORDER </button> </div>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        <% end %>

        <div id="all" class="tabcontent">
            <% if @user_dish.count > 0 %>
                <%= form_tag(home_main_path, method: :get, id: "search") do %>
                    <div class="row">
                        <div class= "col-md-6">
                            FILTER BY SELLER <%= text_field_tag :seller, params[:seller] %>
                        </div>
                        <div class="col-md-6">
                            FILTER BY DISHNAME <%= text_field_tag :dishname, params[:dishname] %>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class= "col-md-6">
                            FILTER BY CUISINE <%= select_tag :cuisine, options_for_select([["American", "American"], ["Chinese", "Chinese"], ["French", "French"], ["Italian","Italian"], ["Indian","Indian"], ["Mexican","Mexican"], ["Thai","Thai"], ["All", "All"]], selected: "All")%>
                        </div>
                        <div class= "col-md-6">
                            FILTER BY PRICE <%= select_tag :price, options_for_select([["< $5", "0, 5"], ["$5 - $10", "5, 10"],["$10 - $15", "10, 15"],["$15 - $20", "15, 20"], ["> $20", "20, 100"], ["All", "All"]], selected: "All")%>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-12">
                            <%= submit_tag 'Show search results'%>
                        </div>
                    </div>
                <% end %>
                <h1> Today's dishes for you </h1>
                <br>
                <% @user_dish.each do |dish| %>
                    <div class="dish"> 
                        <div class="dishtitle">
                            <b><%= dish.dishname %></b> (Only <%= dish.quantity %> servings left! )
                        </div>
                        <div class="dishdetails">
                            <div class="row">
                                <div class="col-md-6 col-sm-12">
                                    Cuisine : <%= dish.cuisine %><br>
                                    Price : $<%= dish.price %><br>
                                    Seller : <%= dish.name %><br>
                                    Description : <%= dish.description %><br>
                                    Zipcode : <%= dish.zipcode %>
                                </div>
                                <div class="col-md-6 col-sm-12 buy_button">
                                    <button class="<%= dish.dishname %>" onclick="showBuyBlock('all <%= dish.dishname %>')"> BUY </button>
                                </div>
                            </div>
                            <div class="row buy_block" id="all <%= dish.dishname %>">
                                <div class="col-md-6"> <button class = "buy"> PLACE ORDER </button> </div>
                                <div class="col-md-6"> <button class = "buy" onclick="hideBuyBlock('all <%= dish.dishname %>')"> CANCEL ORDER </button> </div>
                            </div>
                        </div>
                    </div>
                <% end %>
            <% end %>
        </div>

        <div id="fav_cuisine" class="tabcontent">
            <% if @user_dish_cuisine.count > 0 %>
                <h1> Today's dishes for you based on favorite cuisine</h1>
                <br>
                <% @user_dish_cuisine.each do |dish| %>
                    <div class="dish"> 
                        <div class="dishtitle">
                            <b><%= dish.dishname %></b> (Only <%= dish.quantity %> servings left! )
                        </div>
                        <div class="dishdetails">
                            <div class="row">
                                <div class="col-md-6 col-sm-12">
                                    Cuisine : <%= dish.cuisine %><br>
                                    Price : $<%= dish.price %><br>
                                    Seller : <%= dish.name %><br>
                                    Description : <%= dish.description %><br>
                                    Zipcode : <%= dish.zipcode %>
                                </div>
                                <div class="col-md-6 col-sm-12 buy_button">
                                    <button class="<%= dish.dishname %>" onclick="showBuyBlock('cuisine <%= dish.dishname %>')"> BUY </button>
                                </div>
                            </div>
                            <div class="row buy_block" id="cuisine <%= dish.dishname %>">
                                <div class="col-md-6"> <button class = "buy"> PLACE ORDER </button> </div>
                                <div class="col-md-6"> <button class = "buy" onclick="hideBuyBlock('cuisine <%= dish.dishname %>')"> CANCEL ORDER </button> </div>
                            </div>
                        </div>
                    </div>
                <% end %>
            <% end %>
        </div>
    
        <script>
        function openPage(evt, category) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            console.log(tabcontent);
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            let content = document.getElementById(category)
            console.log(content)
            content.style.display = "block";
            evt.currentTarget.className += " active";

            buy_blocks = document.getElementsByClassName("buy_block")
            for (i = 0; i < buy_blocks.length; i++) {
                buy_blocks[i].style.display = "none";
            }
        }

        $(document).ready(function () {
            document.getElementById("all_button").click(); 
        });

        function showBuyBlock(dish_id) {
            var x = document.getElementById(dish_id);
            x.style.display = "block";
        }

        function hideBuyBlock(dish_id) {
            var x = document.getElementById(dish_id);
            x.style.display = "none";
        }

        </script>     
        <div id = "box" class="container"> 
        <button type="button" class="btn btn-secondary">
            <a href="/dishes/new" method="post"> ADD A NEW DISH </a>
        </button>
        </div>
    </div>
</body>